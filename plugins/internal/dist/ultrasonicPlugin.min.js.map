{"version":3,"sources":["ultrasonicPlugin.js"],"names":["resources","require","utils","pi","sensors","pluginName","Gpio","exports","params","trigger","OUTPUT","echo","mode","INPUT","alert","on","level","tick","digitalWrite","result","startTick","toFixed","model","value","setInterval","clearInterval"],"mappings":"aAAA,IAAIA,OAAAA,UAAYC,QAAQ,yBACtBC,MAAQD,QAAQ,wBAAhBC,MAAQD,UAAQE,GAAAC,QAGZC,WAAa,6BAFjBC,KAAAL,QAAA,UAAAK,KAEAC,QAAIF,MAAU,SAAGG,GAIjB,IAHYC,EAAU,IAACH,KAAD,GAAWA,CAAAA,KACnCA,KAAAI,SAIQC,EAAO,IAAIL,KAAK,GAAI,CAACM,KAAMN,KAAKO,MAAOC,OAAO,IADpDL,EAAMA,aAAcH,GAAS,IACvBK,EAAuCG,EAAKC,GAAE,QAAA,SAAAC,EAAAC,GAApD,GAAAD,EAIAP,EAAQS,GAKFC,UAHcF,GAClB,IAAAG,GAAA,IAEiB,GAXU,IAAI,QAWGC,QAAA,GAChCC,MAAIN,SAAYO,MAAAJ,UASjBK,YAVD,WAHFf,EAAAA,QAAA,GAAA,IAqBG,MADDA,QAAAA,KAAQA,WACTgB","file":"ultrasonicPlugin.min.js","sourcesContent":["var resources = require('../../resources/model'),\n  utils = require('../../utils/utils.js');\n  var sensor;\n  var model = resources.pi.sensors;\n  var pluginName = 'Ultrasonic distance sensor';\n    const Gpio = require('pigpio').Gpio;\n// The number of microseconds it takes sound to travel 1cm at 20 degrees celcius\nexports.start = function (params){\n  const MICROSECDONDS_PER_CM = 1e6/34321;\n  const trigger = new Gpio(23, {mode: Gpio.OUTPUT});\n  const echo = new Gpio(24, {mode: Gpio.INPUT, alert: true});\n  \n  \n  \n  trigger.digitalWrite(0); // Make sure trigger is low\n  \n  const watchHCSR04 = () => {\n    let startTick;\n  \n    echo.on('alert', (level, tick) => {\n      if (level == 1) {\n        startTick = tick;\n      } else {\n        const endTick = tick;\n        const diff = (endTick >> 0) - (startTick >> 0); // Unsigned 32 bit arithmetic\n        result = (diff / 2 / MICROSECDONDS_PER_CM).toFixed(2);\n        model.distance.value = result;\n        //console.log(result);\n      }\n    });\n  };\n  \n  watchHCSR04();\n  \n  // Trigger a distance measurement once per second\n  setInterval(() => {\n    trigger.trigger(10, 1); // Set trigger high for 10 microseconds\n  }, 1000);\n  \n}\n\nexports.stop = function(){\n clearInterval();\n}\n"]}